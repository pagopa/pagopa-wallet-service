openapi: 3.0.3
info:
  title: pagoPA Wallet API
  version: 0.0.1
  description: >-
    API to handle wallets PagoPA, where a wallet is triple between user
    identifier, payment instrument and applications (i.e pagoPA, bpd).
  termsOfService: https://pagopa.it/terms/
  contact:
    name: pagoPA - Touchpoints team
    url: https://www.pagopa.it/
tags:
  - name: wallets
    description: Api's for handle a wallet
    externalDocs:
      url: >-
        https://pagopa.atlassian.net/wiki/spaces/WA/overview?homepageId=622658099
      description: Documentation
security:
  - ApiKeyAuth: [ ]
servers:
  - url: https://${hostname}
    variables:
      hostname:
          description: The hostname of the API server
          default: itnprod.pay-wallet.internal.platform.pagopa.it
          enum:
            - itndev.pay-wallet.internal.dev.platform.pagopa.it
            - itnuat.pay-wallet.internal.uat.platform.pagopa.it
            - itnprod.pay-wallet.internal.platform.pagopa.it
paths:
  /wallets:
    post:
      tags:
        - wallets
      summary: Create a new wallet
      description: Creates a new wallet
      operationId: createWallet
      parameters:
        - in: header
          name: x-user-id
          required: true
          description: The user connected to the to be onboarded wallet
          schema:
            $ref: '#/components/schemas/UserId'
        - in: header
          name: x-client-id
          required: true
          description: Channel from which this wallet will be onboarded
          schema:
            $ref: '#/components/schemas/ClientId'
      requestBody:
        description: Create a new wallet
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WalletCreateRequest'
        required: true
      responses:
        '201':
          description: Wallet created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletCreateResponse'
        '400':
          description: Formally invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: Internal server error serving request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '502':
          description: Gateway error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
    get:
      tags:
        - wallets
      summary: Get wallet by user identifier
      description: Returns a list of wallets related to user
      operationId: getWalletsByIdUser
      parameters:
        - in: header
          name: x-user-id
          required: true
          description: The user connected to the to be onboarded wallet
          schema:
            $ref: '#/components/schemas/UserId'
      responses:
        '200':
          description: Wallet retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Wallets'
        '400':
          description: Invalid input id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Wallet not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
  /wallets/searchBy:
    post:
      tags:
        - wallets
      summary: Search wallets by input parameters
      description: 'GET with body payload - returns a list of wallets matching the search criteria'
      operationId: searchWallets
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchWalletsRequest'
      responses:
        '200':
          description: Wallets retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Wallets'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 400
                detail: Invalid input
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 401
                detail: Unauthorized
        '404':
          description: Wallets not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 404
                detail: Wallets not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 500
                detail: Internal server error
        '504':
          description: Timeout serving request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 504
                detail: Timeout serving request
  /transactions/{transactionId}/wallets:
    post:
      tags:
        - transaction-wallets
      summary: Create a new wallet for transactionId with contextual onboarding
      description: Creates a new wallet for transactionId with contestul onboarding
      operationId: createWalletForTransaction
      parameters:
        - in: header
          name: x-user-id
          required: true
          description: The user connected to the to be onboarded wallet
          schema:
            $ref: '#/components/schemas/UserId'
        - in: header
          name: x-client-id
          required: true
          description: Channel from which this wallet will be onboarded
          schema:
            $ref: '#/components/schemas/ClientId'
        - name: x-ecommerce-session-token
          in: header
          description: ecommerce session token useful for result and cancel url authorization
          required: true
          schema:
            $ref: '#/components/schemas/SessionToken'
        - name: transactionId
          in: path
          description: ecommerce transaction id
          required: true
          schema:
            $ref: '#/components/schemas/TransactionId'
      requestBody:
        description: Create a new wallet
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WalletTransactionCreateRequest'
        required: true
      responses:
        '201':
          description: Wallet created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletTransactionCreateResponse'
        '400':
          description: Formally invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: Internal server error serving request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '502':
          description: Gateway error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
  /wallets/{walletId}:
    get:
      tags:
        - wallets
      summary: Get wallet by id
      description: Returns a single wallet
      operationId: getWalletById
      parameters:
        - in: header
          name: x-user-id
          required: true
          description: The user connected to the to be onboarded wallet
          schema:
            $ref: '#/components/schemas/UserId'
        - name: walletId
          in: path
          description: ID of wallet to return
          required: true
          schema:
            $ref: '#/components/schemas/WalletId'
      responses:
        '200':
          description: Wallet retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletInfo'
        '400':
          description: Invalid input id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Wallet not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
    delete:
      tags:
        - wallets
      summary: Delete wallet by id
      description: Returns a single wallet
      operationId: deleteWalletById
      parameters:
        - in: header
          name: x-user-id
          required: true
          description: The user connected to the to be onboarded wallet
          schema:
            $ref: '#/components/schemas/UserId'
        - name: walletId
          in: path
          description: ID of wallet to return
          required: true
          schema:
            $ref: '#/components/schemas/WalletId'
      responses:
        '204':
          description: Wallet deleted successfully
        '400':
          description: Invalid input id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Wallet not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
    patch:
      tags:
        - wallets
      operationId: patchWallet
      summary: Patch Wallet by walletId
      description: Patches a single wallet
      parameters:
        - in: path
          name: walletId
          required: true
          description: Unique identifier of the wallet
          schema:
            $ref: '#/components/schemas/WalletId'
      requestBody:
        description: Wallet patch status request
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WalletStatusPatchRequest"
      responses:
        "204":
          description: "Wallet update successfully"
        '400':
          description: Invalid input id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Wallet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '409':
          description: Unable to patch wallet status. This can be caused by forbidden state transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: Internal server error serving request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
  /wallets/{walletId}/applications:
    put:
      tags:
        - wallets
      summary: Update wallet applications and their status
      description: Update wallet applications
      operationId: updateWalletApplicationsById
      requestBody:
        description: Update wallet applications for the specified wallet
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WalletApplicationUpdateRequest'
      parameters:
        - in: header
          name: x-user-id
          required: true
          description: The user connected to the to be onboarded wallet
          schema:
            $ref: '#/components/schemas/UserId'
        - name: walletId
          in: path
          description: ID of wallet to return
          required: true
          schema:
            $ref: '#/components/schemas/WalletId'
      responses:
        '204':
          description: Wallet updated successfully
        '409':
          description: |
            Wallet request is inconsistent with global application status
            (e.g. the user requested a application to be enabled but the application has a global status of disabled)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WalletApplicationsPartialUpdate"
        '400':
          description: Invalid input id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Wallet not found or one of the requested applications was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
  /wallets/{walletId}/sessions:
    post:
      tags:
        - wallets
      summary: Create a new session wallet
      description: This endpoint returns an object containing data on how a frontend can build a html form to allow direct exchanging of payment information to the payment gateway without `wallet` having to store PCI data (or other sensitive data tied to the payment method).The returned data is tied to a session on the payment gateway identified by the field `orderId`.
      operationId: createSessionWallet
      parameters:
        - in: header
          name: x-user-id
          required: true
          description: The user connected to the to be onboarded wallet
          schema:
            $ref: '#/components/schemas/UserId'
        - name: walletId
          in: path
          description: ID of wallet to return
          required: true
          schema:
            $ref: '#/components/schemas/WalletId'
      requestBody:
        description: Session input data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionInputData'
      responses:
        '200':
          description: Session Wallet created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionWalletCreateResponse'
        '400':
          description: Formally invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Wallet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: Internal server error serving request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '502':
          description: Gateway error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
  /wallets/{walletId}/sessions/{orderId}:
    get:
      tags:
        - wallets
      summary: Get a session wallet
      description: This endpoint returns an object containing data related to wallet session identified by orderId and walletId.
      operationId: getSessionWallet
      parameters:
        - name: x-user-id
          in: header
          required: true
          description: The user connected to the to be onboarded wallet
          schema:
            $ref: '#/components/schemas/UserId'
        - name: walletId
          in: path
          description: ID of wallet to return
          required: true
          schema:
            $ref: '#/components/schemas/WalletId'
        - name: orderId
          in: path
          description: ID of npg order
          required: true
          schema:
            $ref: '#/components/schemas/OrderId'

      responses:
        '200':
          description: Session Wallet created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionWalletRetrieveResponse'
        '400':
          description: Formally invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Wallet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: Internal server error serving request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '502':
          description: Gateway error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
  /wallets/{walletId}/sessions/{orderId}/validations:
    post:
      tags:
        - wallets
      summary: Create new validation request given a initialized wallet
      description: This endpoint returns an object with a url to which to redirect in case of APM or a url on which to build an iframe for GDI check.
      operationId: postWalletValidations
      security:
        - bearerAuth: [ ]
      parameters:
        - in: header
          name: x-user-id
          required: true
          description: The user connected to the to be onboarded wallet
          schema:
            $ref: '#/components/schemas/UserId'
        - name: walletId
          in: path
          description: ID of wallet
          required: true
          schema:
            $ref: '#/components/schemas/WalletId'
        - name: orderId
          in: path
          description: ID of order session
          required: true
          schema:
            $ref: '#/components/schemas/OrderId'
      responses:
        '200':
          description: Verify requested
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletVerifyRequestsResponse'
        '400':
          description: Invalid input id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Wallet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
  /wallets/{walletId}/sessions/{orderId}/notifications:
    post:
      tags:
        - wallets
      summary: Update Wallet on NPG onboarding authorization response
      description: Update Wallet on NPG onboarding authorization response
      operationId: notifyWallet
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: walletId
          description: Unique identifier of the wallet
          schema:
            $ref: '#/components/schemas/WalletId'
          required: true  
        - in: path
          name: orderId
          schema:
            $ref: '#/components/schemas/OrderId'
          required: true
          description: Unique identifier of the npg session
      requestBody:
        description: Notify wallet
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WalletNotificationRequest'
        required: true
      responses:
        '200':
          description: Notification handled successfully
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 400
                detail: Invalid input
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 401
                detail: Unauthorized
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 500
                detail: Internal server error
  /wallets/{walletId}/sessions/{orderId}/notifications/internal:
    post:
      tags:
        - wallets
      summary: Update Wallet on NPG onboarding authorization response
      description: Update Wallet on NPG onboarding authorization response retrieved by get state retry flow (b2b interaction)
      operationId: notifyWalletInternal
      parameters:
        - in: path
          name: walletId
          description: Unique identifier of the wallet
          schema:
            $ref: '#/components/schemas/WalletId'
          required: true
        - in: path
          name: orderId
          schema:
            $ref: '#/components/schemas/OrderId'
          required: true
          description: Unique identifier of the npg session
      requestBody:
        description: Notify wallet
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WalletNotificationRequest'
        required: true
      responses:
        '200':
          description: Notification handled successfully
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 400
                detail: Invalid input
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 401
                detail: Unauthorized
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
              example:
                type: https://example.com/problem/
                title: string
                status: 500
                detail: Internal server error
  /applications:
    post:
      tags:
        - applications
      summary: Create a new application
      description: Creates a new application
      operationId: createApplication
      requestBody:
        description: Create a new application
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationCreateRequest'
        required: true
      responses:
        '201':
          description: Application created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplicationCreateResponse'
        '400':
          description: Formally invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: Internal server error serving request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '502':
          description: Gateway error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
  /applications/{applicationId}:
    patch:
      tags:
        - applications
      summary: Set application status
      description: Set application status
      operationId: setApplicationStatus
      requestBody:
        description: Set application status
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationPatchRequest'
      parameters:
        - name: applicationId
          in: path
          description: ID of application to return
          required: true
          schema:
            $ref: '#/components/schemas/ApplicationId'
      responses:
        '204':
          description: Application updated successfully
        '400':
          description: Invalid input id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Application not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
  /wallets/{walletId}/auth-data:
    get:
      tags:
        - wallets
      summary: Get wallet auth data by id
      description: Returns auth data for a single wallet
      operationId: getWalletAuthDataById
      parameters:
        - name: walletId
          in: path
          description: ID of wallet to return
          required: true
          schema:
            $ref: '#/components/schemas/WalletId'
      responses:
        '200':
          description: Wallet retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletAuthData'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '404':
          description: Wallet not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Timeout serving request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'

components:
  schemas:
    AmountEuroCents:
      description: Amount for payments, in euro cents
      type: integer
      minimum: 0
      maximum: 99999999
    WalletId:
      description: Wallet identifier
      type: string
      format: uuid
    OrderId:
      description: Order session payment gateway identifier
      type: string
    ClientId:
      description: Clients that can initiate a wallet session
      type: string
      enum:
        - CHECKOUT
        - IO
    UserId:
      description: The User ID
      type: string
      format: uuid
    SessionToken:
      description: The ecommerce session token
      type: string
    TransactionId:
      description: The ecommerce transaction id
      type: string
    WalletVerifyRequestsResponse:
      type: object
      description: Data to perform a wallet verify with payment gateway
      properties:
        orderId:
          $ref: '#/components/schemas/OrderId'
        details:
          description: Redirection URL or iframe url according payment method type
          type: object
          oneOf:
            - $ref: '#/components/schemas/WalletVerifyRequestCardDetails'
            - $ref: '#/components/schemas/WalletVerifyRequestAPMDetails'
            - $ref: '#/components/schemas/WalletVerifyRequestContextualCardDetails'
          discriminator:
            propertyName: type
            mapping:
              CARDS: '#/components/schemas/WalletVerifyRequestCardDetails'
              APM: '#/components/schemas/WalletVerifyRequestAPMDetails'
              CARDS_CTX: '#/components/schemas/WalletVerifyRequestContextualCardDetails'
      required:
        - details
        - orderId
    WalletVerifyRequestCardDetails:
      type: object
      description: Card verify request details
      properties:
        type:
          type: string
          description: Wallet  verify request details discriminator field.
        iframeUrl:
          type: string
          description: iframeUrl in order to run gdi check.
    WalletVerifyRequestContextualCardDetails:
      type: object
      description: Card verify request details for contextual onboarding
      properties:
        type:
          type: string
          description: Wallet verify request details discriminator field.
    WalletVerifyRequestAPMDetails:
      type: object
      description: Alternative Payment Method (APM) verify request details
      properties:
        type:
          type: string
          description: Wallet  verify request details discriminator field.
        redirectUrl:
          type: string
          description: redirect url in order to continue verify.
    WalletApplicationsPartialUpdate:
      type: object
      description: Response for wallet applications partial update due to status conflicts
      properties:
        updatedApplications:
          type: array
          items:
            $ref: "#/components/schemas/WalletApplication"
        failedApplications:
          type: array
          items:
            $ref: "#/components/schemas/WalletApplication"
      example:
        updatedApplications:
          - name: "PAGOPA"
            status: "ENABLED"
        failedApplications:
          - name: "PARI"
            status: "DISABLED"
    ApplicationId:
      description: Application identifier
      type: string
    WalletApplication:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/WalletApplicationId'
        status:
          $ref: '#/components/schemas/WalletApplicationStatus'
    WalletApplicationInfo:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/WalletApplicationId'
        status:
          $ref: '#/components/schemas/WalletApplicationStatus'
      required:
        - name
        - status
    WalletApplicationId:
      type: string
      description: id of the application associated to the wallet
    WalletApplicationStatus:
      type: string
      description: Enumeration of wallet statuses
      enum:
        - ENABLED
        - DISABLED
    ApplicationStatus:
      type: string
      description: Enumeration of wallet statuses
      enum:
        - ENABLED
        - DISABLED
        - INCOMING
    WalletStatus:
      type: string
      description: Enumeration of wallet statuses
      enum:
        - CREATED
        - INITIALIZED
        - VALIDATION_REQUESTED
        - VALIDATED
        - DELETED
        - REPLACED
        - ERROR
    WalletCardDetails:
      type: object
      description: Card payment instrument details
      properties:
        type:
          type: string
          description: Wallet details discriminator field.
        lastFourDigits:
          description: >-
            Card last four digits
          type: string
          minLength: 4
          maxLength: 4
          example: "9876"
        expiryDate:
          type: string
          description: Credit card expiry date. The date format is `YYYYMM`
          pattern: ^\d{6}$
          example: '203012'
        brand:
          description: Payment instrument brand
          type: string
      required:
        - type
        - bin
        - lastFourDigits
        - expiryDate
        - brand
    WalletPaypalDetails:
      type: object
      description: Paypal instrument details
      properties:
        type:
          type: string
          description: Wallet details discriminator field.
        pspId:
          type: string
          description: PSP identifier for the PayPal wallet
        pspBusinessName:
          type: string
          description: PSP business name
        maskedEmail:
          description: masked email
          type: string
          example: test***@***test.it
      required:
        - type
        - pspId
        - pspBusinessName
    WalletApplicationUpdateRequest:
      type: object
      description: Wallet update request
      properties:
        applications:
          type: array
          description: List of applications to update
          items:
            $ref: '#/components/schemas/WalletApplication'
    WalletCreateRequest:
      type: object
      description: Wallet creation request
      properties:
        applications:
          type: array
          description: List of applications for which wallet is enabled
          items:
            $ref: '#/components/schemas/ApplicationId'
        useDiagnosticTracing:
          type: boolean
        paymentMethodId:
          type: string
          format: uuid
      required:
        - applications
        - useDiagnosticTracing
        - paymentMethodId
    WalletCreateResponse:
      type: object
      description: Wallet creation response
      properties:
        walletId:
          $ref: '#/components/schemas/WalletId'
        redirectUrl:
          type: string
          format: url
          description: >-
            Redirection URL to a payment gateway page where the user can input a
            payment instrument information with walletId and useDiagnosticTracing as query param
          example: "http://localhost.example/inputPage?walletId=123&useDiagnosticTracing=true"
      required:
        - walletId
        - redirectUrl
    WalletTransactionCreateRequest:
      type: object
      description: Wallet for transaction with contextual onboarding creation request
      properties:
        useDiagnosticTracing:
          type: boolean
        paymentMethodId:
          type: string
          format: uuid
        amount:
          $ref: '#/components/schemas/AmountEuroCents'
      required:
        - useDiagnosticTracing
        - paymentMethodId
        - amount
    WalletTransactionCreateResponse:
      type: object
      description: Wallet for transaction with contextual onboarding creation response
      properties:
        walletId:
          $ref: '#/components/schemas/WalletId'
        redirectUrl:
          type: string
          format: url
          description: >-
            Redirection URL to a payment gateway page where the user can input a
            payment instrument information with walletId and useDiagnosticTracing as query param
          example: "http://localhost.example/inputPage?walletId=123&useDiagnosticTracing=true"
      required:
        - walletId
    WalletClientStatus:
      type: string
      description: Enumeration of wallet client statuses
      enum:
        - ENABLED
        - DISABLED
    WalletClient:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/WalletClientStatus'
      required:
        - status
    WalletInfo:
      type: object
      description: Wallet information
      properties:
        walletId:
          $ref: '#/components/schemas/WalletId'
        userId:
          type: string
          description: user identifier
        paymentInstrumentId:
          description: Payment instrument identifier
          type: string
        paymentMethodId:
          description: Payment method identifier
          type: string
        status:
          $ref: '#/components/schemas/WalletStatus'
        creationDate:
          description: Wallet creation date
          type: string
          format: date-time
        updateDate:
          description: Wallet update date
          type: string
          format: date-time
        applications:
          description: list of applications for which this wallet is created for
          type: array
          items:
            $ref: '#/components/schemas/WalletApplicationInfo'
        clients:
          description: Client-specific state (e.g. last usage) and configuration (enabled/disabled)
          type: object
          additionalProperties:
            $ref: '#/components/schemas/WalletClient'
        details:
          description: >-
            details for the specific payment instrument. This field is
            discriminated by the type field
          type: object
          oneOf:
            - $ref: '#/components/schemas/WalletCardDetails'
            - $ref: '#/components/schemas/WalletPaypalDetails'
          discriminator:
            propertyName: type
            mapping:
              CARDS: '#/components/schemas/WalletCardDetails'
              PAYPAL: '#/components/schemas/WalletPaypalDetails'
        paymentMethodAsset:
          description: wallet asset
          type: string
          format: uri
      required:
        - walletId
        - paymentMethodId
        - userId
        - status
        - creationDate
        - updateDate
        - type
        - applications
        - clients
        - paymentMethodAsset
    Wallets:
      type: object
      description: Wallets information
      properties:
        wallets:
          type: array
          items:
            $ref: '#/components/schemas/WalletInfo'
    SearchWalletsRequest:
      type: object
      description: Search wallets request with discriminated search criteria
      oneOf:
        - $ref: '#/components/schemas/SearchWalletsRequestFiscalCode'
      discriminator:
        propertyName: type
        mapping:
          USER_FISCAL_CODE: '#/components/schemas/SearchWalletsRequestFiscalCode'
    SearchWalletsRequestFiscalCode:
      type: object
      description: Search wallets by user fiscal code
      properties:
        type:
          type: string
          description: Search criteria discriminator field
        userFiscalCode:
          type: string
          minLength: 16
          maxLength: 16
      required:
        - type
        - userFiscalCode
      example:
        type: "USER_FISCAL_CODE"
        userFiscalCode: "MRGHRN97L02C469W"
    SessionInputData:
      type: object
      description: Data needed to create  session
      oneOf:
        - $ref: "#/components/schemas/SessionInputCardData"
        - $ref: "#/components/schemas/SessionInputPayPalData"
      discriminator:
        propertyName: paymentMethodType
        mapping:
          cards: "#/components/schemas/SessionInputCardData"
          paypal: "#/components/schemas/SessionInputPayPalData"
    SessionInputCardData:
      x-discriminator-value: cards
      type: object
      description: Data required to initialize a card onboarding session
      properties:
        paymentMethodType:
          type: string
      required:
        - paymentMethodType
    SessionInputPayPalData:
      x-discriminator-value: paypal
      type: object
      description: Data required to initialize a PayPal onboarding session
      properties:
        paymentMethodType:
          type: string
        pspId:
          type: string
      required:
        - paymentMethodType
        - pspId
    SessionWalletCreateResponse:
      type: object
      description: Form data needed to create a credit card input form
      properties:
        orderId:
          type: string
        sessionData:
          oneOf:
            - $ref: "#/components/schemas/SessionWalletCreateResponseCardData"
            - $ref: "#/components/schemas/SessionWalletCreateResponseAPMData"
          discriminator:
            propertyName: paymentMethodType
            mapping:
              cards: "#/components/schemas/SessionWalletCreateResponseCardData"
              apm: "#/components/schemas/SessionWalletCreateResponseAPMData"
      required:
        - orderId
        - sessionData
    SessionWalletCreateResponseCardData:
      x-discriminator-value: cards
      type: object
      description: Session data returned by `createSessionWallet` operation in case of a credit card session
      properties:
        paymentMethodType:
          type: string
        cardFormFields:
          type: array
          items:
            $ref: '#/components/schemas/Field'
      required:
        - paymentMethodType
        - cardFormFields
    SessionWalletCreateResponseAPMData:
      x-discriminator-value: apm
      type: object
      description: Session data returned by `createSessionWallet` operation in case of a credit card session
      properties:
        paymentMethodType:
          type: string
        redirectUrl:
          type: string
          format: url
      required:
        - paymentMethodType
        - redirectUrl
    WalletNotificationRequest:
      type: object
      description: Request body for execute wallet notification request
      properties:
        timestampOperation:
          type: string
          format: date-time
          description: Onboarding timestamp
        operationId:
          description: Operation ID
          type: string
        operationResult:
          type: string
          description: outcome received by NPG - https://developer.nexi.it/it/api/notifica
          enum:
            - AUTHORIZED
            - EXECUTED
            - DECLINED
            - DENIED_BY_RISK
            - THREEDS_VALIDATED
            - THREEDS_FAILED
            - PENDING
            - CANCELED
            - VOIDED
            - REFUNDED
            - FAILED
        errorCode:
          type: string
          description: Error code for the onboarding operation received by NPG
        details:
          description: Wallet notified payment method details
          type: object
          oneOf:
            - $ref: '#/components/schemas/WalletNotificationRequestPaypalDetails'
            - $ref: '#/components/schemas/WalletNotificationRequestCardDetails'
          discriminator:
            propertyName: type
            mapping:
              PAYPAL: '#/components/schemas/WalletNotificationRequestPaypalDetails'
              CARD: '#/components/schemas/WalletNotificationRequestCardDetails'
      required:
        - timestampOperation
        - operationResult
    WalletNotificationRequestPaypalDetails:
      type: object
      description: APM wallet notification details for PayPal onboarding
      properties:
        type:
          type: string
          description: discriminator field, fixed value `PAYPAL`
        maskedEmail:
          type: string
      required:
        - type
        - maskedEmail
      example:
        type: PAYPAL
        maskedEmail: t***@t***.it
    WalletNotificationRequestCardDetails:
      type: object
      description: Card wallet notification details for onboarding
      properties:
        type:
          type: string
          description: discriminator field, fixed value `CARD`
        paymentInstrumentGatewayId:
          type: string
      required:
        - type
        - paymentInstrumentGatewayId
      example:
        type: CARD
        paymentInstrumentGatewayId: c2402dcc-ef9d-4c68-8067-e4b6268a2e62
    SessionWalletRetrieveResponse:
      type: object
      description: Data related to session wallet
      properties:
        orderId:
          type: string
        walletId:
          type: string
        isFinalOutcome:
          type: boolean
        outcome:
          type: number
          enum:
            - 0  # SUCCESS
            - 1  # GENERIC_ERROR
            - 2  # AUTH_ERROR
            - 3  # INVALID_DATA
            - 4  # TIMEOUT
            - 7  # INVALID_CARD
            - 8  # CANCELED_BY_USER
            - 14 # INVALID_SESSION
            - 15 # ALREADY_ONBOARDED
            - 25 # PSP_ERROR
            - 116 # BALANCE_LIMIT
            - 117 # CVV_ERROR
            - 121 # LIMIT_EXCEEDED
      required:
        - orderId
        - walletId
        - isFinalOutcome
    Field:
      type: object
      properties:
        type:
          type: string
          example: text
        class:
          type: string
          example: cardData
        id:
          type: string
          example: cardholderName
        src:
          type: string
          format: uri
          example: "https://frontend.example/field.html?id=CARDHOLDER_NAME&sid=052211e8-54c8-4e0a-8402-e10bcb8ff264"
    ApplicationCreateRequest:
      type: object
      description: Application creation request
      properties:
        applicationId:
          type: string
          description: Application id
        status:
          $ref: "#/components/schemas/ApplicationStatus"
      required:
        - name
    ApplicationCreateResponse:
      type: object
      description: Application creation response
      properties:
        applicationId:
          $ref: '#/components/schemas/ApplicationId'
      required:
        - applicationId
    WalletStatusPatchRequest:
      type: object
      oneOf:
        - $ref: '#/components/schemas/WalletStatusErrorPatchRequest'
      discriminator:
        propertyName: status
        mapping:
          ERROR: '#/components/schemas/WalletStatusErrorPatchRequest'
    WalletPatchableStatus:
      description: Patchable wallet status
      type: string
      pattern: "ERROR" # we cannot use enums cause code generator expecting string as discriminator key
    WalletStatusErrorPatchRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/WalletPatchableStatus'
        details:
          type: object
          properties:
            reason:
              type: string
              description: "Reason of error"
          required:
            - reason
      required:
        - status
        - details
    ApplicationPatchRequest:
      type: object
      description: Application updating request
      properties:
        status:
          $ref: "#/components/schemas/ApplicationStatus"
      required:
        - status
    ProblemJson:
      description: Body definition for error responses containing failure details
      type: object
      properties:
        type:
          type: string
          format: uri
          description: |-
            An absolute URI that identifies the problem type. When dereferenced,
            it SHOULD provide human-readable documentation for the problem type
            (e.g., using HTML).
          default: about:blank
          example: https://example.com/problem/constraint-violation
        title:
          type: string
          description: >-
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Application Unavailable
        status:
          $ref: '#/components/schemas/HttpStatusCode'
        detail:
          type: string
          description: |-
            A human readable explanation specific to this occurrence of the
            problem.
          example: There was an error processing the request
        instance:
          type: string
          format: uri
          description: >-
            An absolute URI that identifies the specific occurrence of the
            problem.

            It may or may not yield further information if dereferenced.
    HttpStatusCode:
      type: integer
      format: int32
      description: |-
        The HTTP status code generated by the origin server for this occurrence
        of the problem.
      minimum: 100
      maximum: 600
      exclusiveMaximum: true
      example: 502
    WalletAuthData:
      type: object
      description: Wallet information
      properties:
        walletId:
          $ref: '#/components/schemas/WalletId'
        contractId:
          description: Payment method identifier
          type: string
        brand:
          description: The card brand name
          type: string
        contextualOnboardDetails:
          $ref: '#/components/schemas/ContextualOnboardDetails'
        paymentMethodData:
          oneOf:
            - $ref: "#/components/schemas/WalletAuthCardData"
            - $ref: "#/components/schemas/WalletAuthAPMData"
          discriminator:
            propertyName: paymentMethodType
            mapping:
              cards: "#/components/schemas/WalletAuthCardData"
              apm: "#/components/schemas/WalletAuthAPMData"
      required:
        - contractId
        - brand
        - paymentMethodData
    ContextualOnboardDetails:
      type: object
      properties:
        transactionId:
          type: string
        amount:
          type: integer
          format: int64
        orderId:
          type: string
        sessionId:
          type: string
    WalletAuthCardData:
      x-discriminator-value: cards
      type: object
      properties:
        paymentMethodType:
          type: string
        bin:
          type: string
          description: Bin of user card
      required:
        - paymentMethodType
        - bin
    WalletAuthAPMData:
      x-discriminator-value: apm
      type: object
      properties:
        paymentMethodType:
          type: string
      required:
        - paymentMethodType
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
